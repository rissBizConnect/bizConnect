package org.riss.bizconnect.hr.retire.model.controller;

import java.util.List;

import org.riss.bizconnect.hr.retire.model.dto.Retire;
import org.riss.bizconnect.hr.retire.model.service.RetireService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class RetireController {

	 @Autowired
	    private RetireService retireService;
	 

	    // 퇴직자 목록 조회 (GET)
	    @RequestMapping(value = "/list", method = RequestMethod.GET)
	    public String getRetireeList(Model model) {
	        List<Retire> retireeList = retireService.getRetireeList();
	        model.addAttribute("retireeList", retireeList);
	        return "retireeList";
	    }

	    // 퇴직자 추가 페이지로 이동 (GET)
	    @RequestMapping(value = "/add", method = RequestMethod.GET)
	    public String addRetireeForm() {
	        return "retireeAdd";
	    }

	    // 퇴직자 추가 처리 (POST)
	    @RequestMapping(value = "/add", method = RequestMethod.POST)
	    public String addRetiree(Retire retiree) {
	        retireService.addRetiree(retiree);
	        return "redirect:/retiree/list";
	    }

	    // 퇴직자 수정 페이지로 이동 (GET)
	    @RequestMapping(value = "/edit/{id}", method = RequestMethod.GET)
	    public String editRetireeForm(@PathVariable("id") int retireId, Model model) {
	        Retire retiree = retireService.getRetireeList().stream()
	                          .filter(r -> r.getRetire_no() == retireId)
	                          .findFirst()
	                          .orElse(null);
	        model.addAttribute("retiree", retiree);
	        return "retireeEdit";
	    }

	    // 퇴직자 수정 처리 (POST)
	    @RequestMapping(value = "/edit", method = RequestMethod.POST)
	    public String updateRetiree(Retire retiree) {
	        retireService.updateRetiree(retiree);
	        return "redirect:/retiree/list";
	    }

	    // 퇴직자 삭제 (POST)
	    @RequestMapping(value = "/delete", method = RequestMethod.POST)
	    public String deleteRetiree(@RequestParam("id") int retireId) {
	        retireService.deleteRetiree(retireId);
	        return "redirect:/retiree/list";
	    }
	}
