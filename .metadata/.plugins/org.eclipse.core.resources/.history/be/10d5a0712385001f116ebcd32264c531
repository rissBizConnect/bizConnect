<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
 "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.riss.bizconnect.hr.retire.model.mapper.RetireMapper">

    <!-- 퇴직자 목록 조회 -->
    <select id="selectRetireList" resultType="org.riss.bizconnect.hr.retire.model.dto.Retiree">
        SELECT r.RET_NO AS retireNo,
               u.GID AS gid,
               r.COM_CODE AS comCode,
               r.RET_DATE AS retireDate,
               r.RET_EXITREASON AS comments,
               TRUNC(MONTHS_BETWEEN(r.RET_DATE, u.USER_ENTRY_DATE)) AS totalWorkDays
        FROM TB_RETIRE r
        JOIN TB_USERINFO u ON r.GID = u.GID AND r.COM_CODE = u.COM_CODE
    </select>

    <!-- 퇴직자 추가 -->
    <insert id="insertRetire">
        INSERT INTO TB_RETIRE (RET_NO, GID, COM_CODE, RET_DATE, RET_EXITREASON)
        VALUES (#{retireNo}, #{gid}, #{comCode}, #{retireDate}, #{comments})
    </insert>

    <!-- 퇴직자 수정 -->
    <update id="updateRetire">
        UPDATE TB_RETIRE
        SET RET_EXITREASON = #{comments}, RET_DATE = #{retireDate}
        WHERE RET_NO = #{retireNo}
    </update>

    <!-- 퇴직자 삭제 -->
    <delete id="deleteRetire">
        DELETE FROM TB_RETIRE WHERE RET_NO = #{retireNo}
    </delete>

    <!-- 사원으로 변환 -->
    <update id="convertRetireToUser">
        DELETE FROM TB_RETIRE WHERE RET_NO = #{retireNo};
        UPDATE TB_USERINFO SET USER_ROLE = 'Employee' WHERE GID = #{gid} AND COM_CODE = #{comCode};
    </update>

</mapper>
