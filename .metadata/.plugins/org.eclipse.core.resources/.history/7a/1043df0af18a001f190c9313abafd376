package org.riss.bizconnect.hr.document.model.controller;

import java.util.ArrayList;

import javax.servlet.http.HttpServletRequest;

import org.riss.bizconnect.hr.document.model.dto.Certificate;
import org.riss.bizconnect.hr.document.model.service.CertificateService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
public class DocumentController {
    
    @Autowired
    private CertificateService certificateService; // 서비스 주입
    
    // 증명서 추가
    @RequestMapping(value = "cerAdd.do", method = RequestMethod.POST) // POST 요청을 처리
    @ResponseBody
    public String insertCertificate(HttpServletRequest request) {
        Certificate certificate = new Certificate();
        // 클라이언트로부터 받은 데이터를 CertificateDTO에 설정
        certificate.setContractsTitle(request.getParameter("contractsTitle"));
        certificate.setContractsDate(request.getParameter("contractsDate"));
        certificate.setContractsFile(request.getParameter("contractsFile"));
        certificate.setContractsDescription(request.getParameter("contractsDescription"));
        certificate.setGid(request.getParameter("gid")); // 로그인 아이디
        certificate.setComCode(request.getParameter("comCode")); // 회사 코드
        certificateService.insertCertificate(certificate); // 증명서 추가
        return "증명서가 추가되었습니다!";
    }

    // 증명서 목록 조회
    @RequestMapping(value = "cerList.do", method = RequestMethod.GET) // GET 요청을 처리
    @ResponseBody
    public ArrayList<Certificate> selectCertificates(HttpServletRequest request) {
        String gid = request.getParameter("gid"); // 로그인 아이디
        String comCode = request.getParameter("comCode"); // 회사 코드
        return certificateService.selectCertificates(Certificate certificate); // 증명서 목록 조회
    }

    // 증명서 수정
    @RequestMapping(value = "cerUpdate.do", method = RequestMethod.PUT) // PUT 요청을 처리
    @ResponseBody
    public String updateCertificate(
    		HttpServletRequest request) {
        Certificate certificate = new Certificate();
        // 클라이언트로부터 받은 데이터를 CertificateDTO에 설정
        certificate.setContractId(Long.parseLong(request.getParameter("contractId")));
        certificate.setContractsTitle(request.getParameter("contractsTitle"));
        certificate.setContractsFile(request.getParameter("contractsFile"));
        certificate.setContractsDescription(request.getParameter("contractsDescription"));
        certificateService.updateCertificate(certificate); // 증명서 수정
        return "증명서가 수정되었습니다!";
    }

    // 증명서 삭제
    @RequestMapping(value = "cerDelete.do", method = RequestMethod.DELETE) // DELETE 요청을 처리
    @ResponseBody
    public String deleteCertificate(
    		HttpServletRequest request) {
        Certificate certificate = new Certificate();
        // 클라이언트로부터 받은 데이터를 CertificateDTO에 설정
        certificate.setGid(request.getParameter("gid")); // 로그인 아이디
        certificate.setComCode(request.getParameter("comCode")); // 회사 코드
        certificate.setContractsFile(request.getParameter("contractsFile")); // 파일 경로
        certificateService.deleteCertificate(certificate); // 증명서 삭제
        return "증명서가 삭제되었습니다!";
    }

}
