<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="retireMapper">

    <resultMap type="Retire" id="retireResult" >
        <id property="retNo" column="RET_NO" /> <!-- 퇴직자 사번 -->
        <result property="retType" column="RET_TYPE" /> <!-- 고용형태 -->
        <result property="ExitReason" column="RET_EXITREASON" /> <!-- 퇴직 사유 (비고) -->
        <result property="retDate" column="RET_DATE" /> <!-- 퇴사일 -->
        <result property="retTotalDate" column="RET_TOTAL_DATE" /> <!-- 총 근무일 -->
        <result property="gid" column="GID" /> <!-- 유저 GID -->
        <result property="comCode" column="COM_CODE" /> <!-- 회사코드 -->
        <result property="status" column="STATUS" /> <!-- 퇴직자 여부 ('Y' or 'N') -->
        
        <association property="user" javaType="org.riss.bizconnect.common.model.dto.Member">
        <result property="userEntry" column="USER_ENTRY_DATE" />
    	</association>
    </resultMap>
    
    
    <select id="selectRetireList" resultMap="retireResult">
    SELECT * 
    FROM (
        SELECT ROWNUM AS RNUM, 
               R.*, 
               U.USER_ENTRY_DATE -- 입사일 추가
        FROM TB_RETIRE R
        JOIN TB_USERINFO U ON R.GID = U.GID AND R.COM_CODE = U.COM_CODE -- 조인 조건
        WHERE R.COM_CODE = #{comCode} 
        AND R.STATUS = 'N' <!-- 퇴직자만 조회 -->
        ORDER BY R.RET_DATE DESC <!-- 퇴사일 기준으로 정렬 -->
    ) 
    WHERE RNUM BETWEEN #{startRow} AND #{endRow}
</select>
	
    <select id="selectAllRetirees" resultMap="retireResult">
    SELECT * 
    FROM TB_RETIRE 
    WHERE COM_CODE = #{comCode}
    AND STATUS = 'N' <!-- 퇴직자만 조회 -->
	</select>
	
	<select id="selectListCount" resultType="int">
    SELECT COUNT(*) 
    FROM TB_RETIRE 
    WHERE COM_CODE = #{comCode} 
    AND STATUS = 'N' <!-- 퇴직자만 조회 -->
	</select>
    
    <insert id="addRetire" parameterType="org.riss.bizconnect.hr.retire.model.dto.Retire">
        INSERT INTO TB_RETIRE (RET_NO, RET_TYPE, RET_EXITREASON, RET_DATE, RET_TOTAL_DATE, GID, COM_CODE, STATUS)
        VALUES (#{retNo}, #{retType}, #{ExitReason}, #{retDate}, #{retTotalDate}, #{gid}, #{comCode}, #{status})
    </insert>

    <update id="updateRetire" parameterType="org.riss.bizconnect.hr.retire.model.dto.Retire">
        UPDATE TB_RETIRE
        SET RET_TYPE = #{retType}, RET_EXITREASON = #{ExitReason}, RET_DATE = #{retDate}, RET_TOTAL_DATE = #{retTotalDate}, STATUS = #{status}
        WHERE RET_NO = #{retNo}
    </update>

    <delete id="deleteRetire" parameterType="String">
        DELETE FROM TB_RETIRE WHERE RET_NO = #{retNo}
    </delete>

</mapper>